<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Danh sách bàn chờ thanh toán</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <th:block th:replace="fragments/cashier/head :: head ('Cashier - POS')"></th:block>
  <style>
    body {
      background-color: #f0f2f5;
      font-family: 'Segoe UI', sans-serif;
    }
    .btn-back {
      border-radius: 30px;
    }
    .title-bar {
      border-bottom: 2px solid #dee2e6;
      margin-bottom: 30px;
    }
  </style>
</head>
<body>
<div class="row">
  <!-- Sidebar -->
  <div class="col-2" th:replace="~{fragments/cashier/sidebar :: sidebar}"></div>

  <!-- Main content -->
  <div class="container col-10 py-1" style="margin-right: 20px">
    <div th:replace="~{fragments/cashier/header :: header}"></div>

    <!-- Tiêu đề -->
    <div class="d-flex justify-content-between align-items-center title-bar pb-2">
      <h2 class="fw-bold text-dark m-2">Danh sách hóa đơn đang chờ thanh toán</h2>
      <a th:href="@{/cashier}" class="btn btn-outline-secondary btn-back">
        <i class="bi bi-arrow-left"></i> Quay về
      </a>
    </div>

    <!-- Bảng danh sách hóa đơn -->
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Bàn</th>
          <th>Nhân viên</th>
          <th>Thời gian gọi món</th>
          <th>Trạng thái</th>
          <th>Hành động</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="invoice, iterStat : ${invoices}">
          <td th:text="${iterStat.count}"></td>
          <td th:text="${invoice.tableName}"></td>
          <td th:text="${invoice.employeeName}"></td>
          <td th:text="${#temporals.format(invoice.orderTime, 'dd/MM/yyyy HH:mm')}"></td>
          <td>
            <span th:if="${invoice.paid}" class="badge bg-success">Đã thanh toán</span>
            <span th:if="${!invoice.paid}" class="badge bg-warning text-dark">Chưa thanh toán</span>
          </td>
          <td class="d-flex flex-column flex-md-row gap-2">
            <a class="btn btn-outline-primary btn-sm"
               th:href="@{'/cashier/' + ${invoice.id}+'/invoice'}">
              <i class="bi bi-eye"></i> Chi tiết
            </a>

            <a class="btn btn-warning btn-sm"
               th:href="@{'/cashier/invoices/edit/' + ${invoice.id}}">
              <i class="bi bi-pencil-square"></i> Sửa
            </a>

            <th:block th:if="${!invoice.paid}">
              <button class="btn btn-success btn-sm"
                      data-bs-toggle="modal"
                      th:attr="data-bs-target='#checkoutModal__' + ${invoice.id}">
                <i class="bi bi-cash-coin"></i> Thanh toán
              </button>

              </div>
            </th:block>
          </td>

        </tr>

        </tbody>
      </table>
    </div>

    <!-- Không có hóa đơn -->
    <div th:if="${#lists.isEmpty(invoices)}" class="text-center mt-5">
      <p class="text-muted">Không có bàn nào đang chờ thanh toán.</p>
    </div>
    <nav th:if="${totalPages > 1}" aria-label="Page navigation">
      <ul class="pagination justify-content-center mt-4">
        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
          <a class="page-link" th:href="@{|/cashier/invoices?page=${currentPage - 1}|}">Trước</a>
        </li>

        <li class="page-item"
            th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
            th:classappend="${i == currentPage} ? 'active'">
          <a class="page-link" th:href="@{|/cashier/invoices?page=${i}|}" th:text="${i + 1}">1</a>
        </li>

        <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
          <a class="page-link" th:href="@{|/cashier/invoices?page=${currentPage + 1}|}">Sau</a>
        </li>
      </ul>
    </nav>
    <div th:replace="~{fragments/cashier/footer :: footer}"></div>
  </div>
</div>

<th:block th:replace="fragments/cashier/script :: script"></th:block>
<script>
  function printInvoice(invoiceId) {
    const printContent = document.getElementById('printSection__' + invoiceId);
    const WinPrint = window.open('', '', 'width=800,height=650');
    WinPrint.document.write(`
      <html>
        <head>
          <title>Hóa đơn tạm tính</title>
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
          <style>
            body {
              font-family: 'Segoe UI', sans-serif;
              font-size: 14pt;
              padding: 30px;
            }
            table {
              width: 100%;
              border-collapse: collapse;
            }
            th, td {
              text-align: center;
              border: 1px solid #ccc;
              padding: 6px;
            }
            h4 {
              text-align: center;
              margin-bottom: 20px;
            }
          </style>
        </head>
        <body onload="window.print(); setTimeout(() => { window.close(); }, 100)">
          ${printContent.innerHTML}
        </body>
      </html>
    `);
    WinPrint.document.close();
  }
</script>
</body>
</html>