<html layout:decorate="~{layouts/no-sidebar-layout}" xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
    <title>ƒê∆°n h√†ng - B·∫øp</title>
    <style>
        .order-card {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .badge-status {
            font-size: 0.9rem;
        }

        .list-group-item-new {
            background-color: white;
        }
        .list-group-item-cooking {
            background-color: gold;
        }
        .list-group-item-ready {
            background-color: springgreen;
        }
        .list-group-item-served {
            background-color: #e2e3e5;
        }
    </style>
</head>
<div layout:fragment="content">
    <h2 class="mb-4">M√≥n c·∫ßn ch·∫ø bi·∫øn</h2>
    <div th:if="${undoItemId != null}" class="alert alert-info alert-dismissible fade show" role="alert" id="undoAlert">
        ƒê√£ thay ƒë·ªïi tr·∫°ng th√°i m√≥n.
        <form th:action="@{'/kitchen/dashboard/item/' + ${undoItemId} + '/undo'}" method="post" style="display:inline;">
            <input type="hidden" name="status" th:value="${undoOldStatus}" />
            <input type="hidden" name="filter" th:value="${undoFilter}" />
            <input type="hidden" name="date" th:value="${undoDate}" />
            <button type="submit" class="btn btn-link p-0 m-0 align-baseline">Ho√†n t√°c</button>
        </form>
    </div>

    <form class="mb-3 d-flex align-items-center gap-2" method="get" th:action="@{/kitchen/dashboard}">
        <input type="hidden" name="filter" th:value="${currentFilter}" />
        <label for="date" class="form-label mb-0">Ng√†y:</label>
        <input type="date" id="date" name="date"
               th:value="${selectedDate}" class="form-control" style="max-width: 200px;" onchange="this.form.submit()" />

    </form>


    <!-- Tabs l·ªçc tr·∫°ng th√°i -->
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
            <a class="nav-link"
               th:classappend="${currentFilter == 'ALL'} ? 'active'"
               th:href="@{/kitchen/dashboard(filter='ALL', date=${currentDate})}">
                T·∫•t c·∫£
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link"
               th:classappend="${currentFilter == 'NEW'} ? 'active'"
               th:href="@{/kitchen/dashboard(filter='NEW', date=${currentDate})}">
                Ch∆∞a b·∫Øt ƒë·∫ßu
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link"
               th:classappend="${currentFilter == 'COOKING'} ? 'active'"
               th:href="@{/kitchen/dashboard(filter='COOKING', date=${currentDate})}">
                ƒêang ch·∫ø bi·∫øn
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link"
               th:classappend="${currentFilter == 'READY'} ? 'active'"
               th:href="@{/kitchen/dashboard(filter='READY', date=${currentDate})}">
                ƒê√£ s·∫µn s√†ng
            </a>
        </li>
    </ul>
    <!-- Giao di·ªán c√°c nh√≥m ƒë∆°n h√†ng -->
    <div class="row">
        <div class="col-12 col-md-6 mb-4" th:each="group : ${groupedOrders}">
            <div class="order-card bg-white d-flex flex-column justify-content-between">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <strong th:text="'B√†n ' + ${group.tableName}">B√†n 01</strong> |
                        <small th:text="${#temporals.format(group.createdAt, 'HH:mm dd/MM/yyyy')}">12:00</small>
                    </div>
                </div>

                <!-- Danh s√°ch m√≥n -->
                <ul class="list-group"  >
                    <li class="list-group-item"
                        th:each="item : ${group.orderItems}"
                        th:if="${item.status.name() != 'CANCELED'}"
                        th:classappend="' list-group-item-' + (${item.status.name().toLowerCase()})">


                        <div class="d-flex justify-content-between">
                            <div>
                                <strong th:text="${item.menuItem.name}">T√™n m√≥n</strong>
                                <span class="badge bg-primary rounded-pill" th:text="'x' + ${item.quantity}">x1</span>
                            </div>
                            <form th:action="@{'/kitchen/dashboard/item/' + ${item.id} + '/status'}" method="post" onsubmit="playNotify()">
                                <input type="hidden" name="date" th:value="${currentDate}" />
                                <input type="hidden" name="filter" th:value="${currentFilter}" />

                                <input type="hidden" name="status" th:if="${item.status.name() == 'NEW'}" value="COOKING"/>
                                <input type="hidden" name="status" th:if="${item.status.name() == 'COOKING'}" value="READY"/>
                                <input type="hidden" name="status" th:if="${item.status.name() == 'READY'}" value="SERVED"/>

                                <button type="submit" th:if="${item.status.name() == 'NEW'}" class="btn btn-outline-warning btn-sm">B·∫Øt ƒë·∫ßu</button>
                                <button type="submit" th:if="${item.status.name() == 'COOKING'}" class="btn btn-outline-success btn-sm">S·∫µn s√†ng</button>
                                <button type="submit" th:if="${item.status.name() == 'READY'}" class="btn btn-success btn-sm">ƒê√£ s·∫µn s√†ng</button>
                            </form>
                        </div>
                    </li>
                </ul>

                <!-- M√≥n b·ªã hu·ª∑ -->
<!--                <div class="mt-2" th:if="${group.hasCanceledItems()}">-->
<!--                    <p class="text-danger small">* M·ªôt s·ªë m√≥n ƒë√£ b·ªã hu·ª∑:</p>-->
<!--                    <ul class="list-group list-group-flush">-->
<!--                        <li class="list-group-item text-danger small"-->
<!--                            th:each="item : ${group.orderItems}"-->
<!--                            th:if="${item.status == T(com.something.restaurantpos.entity.OrderItem.ItemStatus).CANCELED}">-->
<!--                            <span th:text="${item.menuItem.name}">T√™n m√≥n</span> - -->
<!--                            <span th:text="'SL: ' + ${item.quantity}">SL: 1</span>-->
<!--                        </li>-->
<!--                    </ul>-->
<!--                    <form th:action="@{'/kitchen/dashboard/order/' + ${item.order.id} + '/delete'}" method="post"-->
<!--                          onsubmit="return confirm('·∫®n ƒë∆°n n√†y kh·ªèi m√†n h√¨nh b·∫øp?')">-->
<!--                        <input type="hidden" name="date" th:value="${currentDate}" />-->
<!--                        <input type="hidden" name="filter" th:value="${currentFilter}" />-->
<!--                        <button type="submit" class="btn btn-outline-danger btn-sm mt-2">üóëÔ∏è ƒê√≥ng (·∫©n)</button>-->
<!--                    </form>-->
<!--                </div>-->
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="modal">
    <audio id="notifySound" src="https://www.myinstants.com/media/sounds/bell-notification.mp3" preload="auto"></audio>
</th:block>

<th:block layout:fragment="script">
    <script>
        function playNotify() {
            document.getElementById("notifySound").play();
        }
        setTimeout(() => {
            const alert = document.getElementById("undoAlert");
            if (alert) {
                alert.classList.remove("show");
                alert.classList.add("hide");
            }
        }, 3000);
    </script>
</th:block>
</html>
