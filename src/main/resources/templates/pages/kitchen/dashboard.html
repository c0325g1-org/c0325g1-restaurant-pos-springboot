<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Khu v·ª±c B·∫øp | Restaurant POS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .order-card {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 1rem;
            margin-bottom: 1rem;
            height: 100%;
        }
        .badge-status {
            font-size: 0.9rem;
        }
        .late-order {
            background-color: #fff3cd !important;
        }
        .list-group-item-cooking {
            background-color: gold; /* V√†ng */
        }
        .list-group-item-ready {
            background-color: springgreen; /* Xanh l√° */
        }
        .list-group-item-served {
            background-color: #e2e3e5; /* X√°m */
        }

    </style>
</head>
<body>
<div class="container py-4">
    <h2 class="mb-4">M√≥n c·∫ßn ch·∫ø bi·∫øn</h2>

    <!-- Tabs l·ªçc tr·∫°ng th√°i -->
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item"><a class="nav-link" th:classappend="${currentFilter == 'ALL'} ? 'active'"
                                th:href="@{/kitchen(filter='ALL')}">T·∫•t c·∫£</a></li>
        <li class="nav-item"><a class="nav-link" th:classappend="${currentFilter == 'NEW'} ? 'active'"
                                th:href="@{/kitchen(filter='NEW')}">Ch∆∞a b·∫Øt ƒë·∫ßu</a></li>
        <li class="nav-item"><a class="nav-link" th:classappend="${currentFilter == 'COOKING'} ? 'active'"
                                th:href="@{/kitchen(filter='COOKING')}">ƒêang ch·∫ø bi·∫øn</a></li>
        <li class="nav-item"><a class="nav-link" th:classappend="${currentFilter == 'READY'} ? 'active'"
                                th:href="@{/kitchen(filter='READY')}">ƒê√£ s·∫µn s√†ng</a></li>
    </ul>

    <!-- Giao di·ªán c√°c nh√≥m ƒë∆°n h√†ng -->
    <div class="row">
        <div class="col-12 col-md-6 mb-4" th:each="group : ${groupedOrders}">
            <div class="order-card d-flex flex-column justify-content-between">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <strong th:text="'B√†n ' + ${group.tableName}">B√†n 01</strong> |
                        <small th:text="${#temporals.format(group.createdAt, 'HH:mm dd/MM/yyyy')}">12:00</small>
                    </div>
                </div>

                <!-- Danh s√°ch m√≥n -->
                <ul class="list-group"  >
                    <li class="list-group-item"
                        th:each="item : ${group.orderItems}"
                        th:if="${item.status != T(com.something.restaurantpos.entity.OrderItem.ItemStatus).CANCELED}"
                        th:classappend="' list-group-item-' + (${item.status.name().toLowerCase()})">


                    <div class="d-flex justify-content-between">
                            <div>
                                <strong th:text="${item.menuItem.name}">T√™n m√≥n</strong>
                                <span class="badge bg-primary rounded-pill" th:text="'x' + ${item.quantity}">x1</span>
                            </div>
                            <form th:action="@{'/kitchen/item/' + ${item.id} + '/status'}" method="post" onsubmit="playNotify()">
                                <input type="hidden" name="status" th:if="${item.status.name() == 'NEW'}" value="COOKING"/>
                                <input type="hidden" name="status" th:if="${item.status.name() == 'COOKING'}" value="READY"/>
                                <input type="hidden" name="status" th:if="${item.status.name() == 'READY'}" value="SERVED"/>

                                <button type="submit" th:if="${item.status.name() == 'NEW'}" class="btn btn-outline-warning btn-sm">B·∫Øt ƒë·∫ßu</button>
                                <button type="submit" th:if="${item.status.name() == 'COOKING'}" class="btn btn-outline-success btn-sm">S·∫µn s√†ng</button>
                                <button type="submit" th:if="${item.status.name() == 'READY'}" class="btn btn-success btn-sm">ƒê√£ ph·ª•c v·ª•</button>
                            </form>
                        </div>
                    </li>
                </ul>

                <!-- M√≥n b·ªã hu·ª∑ -->
                <div class="mt-2" th:if="${group.hasCanceledItems()}">
                    <p class="text-danger small">* M·ªôt s·ªë m√≥n ƒë√£ b·ªã hu·ª∑:</p>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item text-danger small"
                            th:each="item : ${group.orderItems}"
                            th:if="${item.status == T(com.something.restaurantpos.entity.OrderItem.ItemStatus).CANCELED}">
                            <span th:text="${item.menuItem.name}">T√™n m√≥n</span> -
                            <span th:text="'SL: ' + ${item.quantity}">SL: 1</span>
                        </li>
                    </ul>
                    <form th:action="@{'/kitchen/order/' + ${item.order.id} + '/delete'}" method="post"
                          onsubmit="return confirm('·∫®n ƒë∆°n n√†y kh·ªèi m√†n h√¨nh b·∫øp?')">
                        <button type="submit" class="btn btn-outline-danger btn-sm mt-2">üóëÔ∏è ƒê√≥ng (·∫©n)</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Thanh ph√¢n trang -->
    <nav th:if="${totalPages > 1}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/kitchen(page=${currentPage - 1}, filter=${currentFilter})}">¬´</a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link" th:href="@{/kitchen(page=${i}, filter=${currentFilter})}" th:text="${i + 1}">1</a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/kitchen(page=${currentPage + 1}, filter=${currentFilter})}">¬ª</a>
            </li>
        </ul>
    </nav>
</div>

<!-- √Çm thanh c·∫£nh b√°o -->
<audio id="notifySound" src="https://www.myinstants.com/media/sounds/bell-notification.mp3" preload="auto"></audio>
<script>
    function playNotify() {
        document.getElementById("notifySound").play();
    }
</script>
</body>
</html>
